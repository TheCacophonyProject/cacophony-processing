dist: bionic
language: python
python:
- '3.9'
install:
- pip install -r requirements.txt
script:
- pytest
before_deploy:
- "pip install pex"
- "mkdir -p /tmp/x"
- "curl -sL https://github.com/goreleaser/nfpm/releases/download/v0.9.5/nfpm_0.9.5_Linux_x86_64.tar.gz | tar -C /tmp/x -xzf -"
- "PATH=/tmp/x:$PATH _release/build ${TRAVIS_TAG}"

deploy:
  provider: releases
  api_key:
    secure: F7d8pO6uTcCnTEBpK6fX4aL9W69DXRVSBSd88GmeggvkUFKW7Y9MWh0ri3i5Ebefm3j+v34boCDirsE+/Fa5BgnlzLxhG7vdOnkQwN0gj1h14w45iJS9GcKnr4APbOVEvPoJwWJiVc4EL6nSoNNfUdZ4+KtDcSopVI0Jhnh79lLVJV0KcZaxj791jmLoeoAF6jLO2D8hi1sSsW+VqNopgZQbnxJ0LkvFFsRYh3ozlan/Ob7RFrkVPVnY57zOvUXuher7TjRvOH/EO331nCyIXY8xHSjg7vtBo5tyzZLLx8lOH60L1/6Ji04icI7Mrw63t0LgP3/JK/WhsFjJh79l94IbI1eL9tcApp1thUIG+6JQ8xZV9kpVxQMqL6qdJN1RrbPnKga2j+AHy1P/V0zObJ2DvgNAbrCrs447dH76GP07nH4+IY9zVWZfsYgjdrbqz35nXaJ0kzVzMFB+rGg87k3+FnW4/PKH7SWMQq8r+nHuE/KxyDGS7Kb21yhJ5cQCXySK381ySntCuJZaGrCKheY5AhlcRYEKcUtFhqTMQCAXeETYttVezB8AfKmDYNouypvhXYPLraSrCxJDdghw58Y73GU8YHnvvCY8r/vxbNT1LxemSGITtqrrV9IgPVvcvXrTokDa0iP3b9YrhsRJqiPHwnFldgrAqVlSrrBZr4o=
  skip_cleanup: 'true'
  file_glob: true
  file: "build/*.deb"
  on:
    repo: TheCacophonyProject/cacophony-processing
    tags: true
